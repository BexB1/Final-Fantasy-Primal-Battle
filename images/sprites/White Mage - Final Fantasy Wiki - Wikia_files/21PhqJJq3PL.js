window.define("ClientSideMetrics",["JSONUtils","ClientSideUtils","EventUtils",window,document],function(q,n,r,l,k){function p(m,a,f,g,b,s){return m+"/event/"+a+"?"+("arid\x3d"+f+"\x26abid\x3d"+g+(s?"\x26testing\x3dtrue":""))+"\x26ev\x3d"+encodeURIComponent(q.from(b))}function h(a,e,f,g,b){b={tags:b||"fallback",type:"error",clientEventTime:(new Date).getTime()};a&&(b.message="[object Error]"===Object.prototype.toString.apply(a)?a.message:a);e&&(b.url=e);f&&(b.lineNumber=f);g&&(b.columnNumber=g);return b}
function t(){var a={},e=k.documentElement,f=k.getElementsByTagName("body")[0];a.viewportSize=(window.innerWidth||e.clientWidth||f.clientWidth)+"x"+(window.innerHeight||e.clientHeight||f.clientHeight);window.performance&&window.performance.timing?(a.navigationStartTime=window.performance.timing.navigationStart,a.clientStartTime=window.performance.timing.domLoading,a.clientEndTime=window.performance.timing.domComplete):(a.clientStartTime=u,a.clientEndTime=(new Date).getTime());window.performance&&window.performance.navigation&&
(a.navigationType=window.performance.navigation.type,a.navigationRedirectCount=window.performance.navigation.redirectCount);e=window.registerFallbackHandler||function(){};try{window.location&&(a.clientProtocol=window.location.protocol)}catch(g){e("cse",h("Failed window.location: "+g,void 0,void 0,void 0,"ignored"))}try{window.parent&&window.parent===window&&(a.adNotInIframe=!0)}catch(b){e("cse",h("Failed window.parent: "+b,void 0,void 0,void 0,"ignored"))}window.JSON&&window.JSON.stringify||(a.noNativeJson=
!0);"string"===typeof k.compatMode&&(a.inQuirksMode="CSS1Compat"!==k.compatMode);return a}var u=(new Date).getTime(),a=n.Metric,v=r.getClickXY,w=new n.PixelQueue;return{init:function(m,e,f,g){var b=function(){return function(a,b){var c=new Image;c.src=p(m,a,e,f,b,g);c.style.display="none";c.width=c.height=1;w.addPixel(c)}}();window.registerFallbackHandler&&window.registerFallbackHandler(function(a,d,c,e,f){b("cse",h(a,d,c,e,f))});new a({start:"load",limit:1,element:window,after:function(){b("csm",
t())}});new a({start:"load",limit:1,element:window,after:function(){if(window.performance&&window.performance.timing)var a=setInterval(function(){0!==window.performance.timing.loadEventEnd&&(clearInterval(a),b("csi",{type:"performanceTiming",performanceTiming:window.performance.timing}))},50)}});new a({start:"mouseover",limit:1,after:function(a){b("csi",{type:"touch",touchStart:a})}});new a({start:"mouseover",end:"mouseout",limit:1,a:500,after:function(a,d){b("csi",{type:"hover",hoverStart:a,hoverDuration:d})}});
new a({start:"play",end:["pause","ended"],limit:1,a:0,after:function(a,d){b("csi",{type:"play",playStart:a,playTime:d})}});new a({start:"dra-video-playallowed",custom:!0,limit:1,after:function(){b("csi",{type:"dra-video-playallowed"})}});new a({start:"dra-video-playblocked",custom:!0,limit:1,after:function(){b("csi",{type:"dra-video-playblocked"})}});new a({start:"dra-visible",custom:!0,limit:1,after:function(a,d,c){0<c&&b("csi",{type:"dra-hidden-ad-rendered",hiddenTimeMs:c})}});new a({start:"dra-visibility-polling-timeout",
custom:!0,limit:1,after:function(a,d,c){b("csi",{type:"dra-hidden-ad-timeout",hiddenTimeMs:c})}});new a({start:"dra-landscape",custom:!0,limit:1,after:function(){b("csi",{type:"landscape",landscape:!0})}});new a({start:"dra-portrait",custom:!0,limit:1,after:function(){b("csi",{type:"landscape",landscape:!1})}});new a({start:"click",after:function(a,d,c){a=v(c);d=k.getElementById("dra-body");b("csi",{type:"click",clickX:a.pageX,clickY:a.pageY,bodySize:d?d.offsetWidth+"x"+d.offsetHeight:void 0})}});
new a({start:"simulate-click-unsupported",custom:!0,limit:1,after:function(a,d,c){b("csi",{type:"simulate-click-unsupported",useragent:c&&"string"===typeof c[0]?c[0].substring(0,512):"NONE"})}});new a({start:"dra-osdetect-error",custom:!0,limit:1,after:function(a,d,c){b("cse",h(c?"MoPub userAgent mismatch: Provided: "+c[0]+"; Actual: "+c[1]+"; Raw User Agent: "+(l.navigator&&l.navigator.userAgent?l.navigator.userAgent.substring(0,512):"NONE"):"MoPub userAgent mismatch",void 0,void 0,void 0,"dra-osdetect-error"))}});
new a({start:"dra-nexage-openinbrowser-timeout",custom:!0,limit:1,after:function(){b("cse",h("Nexage SDK openInBrowser timeout",void 0,void 0,void 0,"dra-nexage-openinbrowser-timeout"))}});new a({start:"dra-aman-msdkbridge-error",custom:!0,limit:1,after:function(a,d,c){b("cse",h(c.amazon?"amazon.openInExternalBrowser \x3d "+typeof c.amazon.openInExternalBrowser:"amazon bridge missing",void 0,void 0,void 0,"dra-aman-msdkbridge-error"))}});new a({start:"pretrashed",limit:1,custom:!0,after:function(){b("csi",
{type:"pretrashed"})}});new a({start:"trashed",limit:10,custom:!0,after:function(){b("csi",{type:"trashed"})}});new a({start:"restored",limit:10,custom:!0,after:function(){b("csi",{type:"restored"})}});new a({start:"dra-creative-timeout",limit:1,custom:!0,after:function(){b("csi",{type:"creative-timeout"})}})},formatPetsEvent:p}});